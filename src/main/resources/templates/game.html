<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Kla Klouk - Modern</title>
    <!-- Tailwind CSS via CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        /* Custom font for the entire game */
        @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@300;500;800&display=swap');

        body { font-family: 'Outfit', sans-serif; }

        /* Soft "table mat" background for the betting area */
        .game-mat {
            background-image: radial-gradient(
                circle farthest-corner at 10% 20%,
                rgba(255,252,213,1) 0%,
                rgba(240,230,200,1) 90%
            );
            box-shadow:
                inset 0 0 40px rgba(0,0,0,0.2),
                0 20px 50px rgba(0,0,0,0.5);
        }

        /* Smooth hover animation for each symbol tile */
        .symbol-container {
            transition: all 0.2s ease;
        }
        .symbol-container:hover {
            filter: brightness(1.05);
            transform: translateY(-2px);
        }

        /* Chip (banknote) selection effect */
        .banknote-wrapper {
            transition: all 0.2s ease;
        }

        .banknote-wrapper img {
            transition: inherit;
        }

        /* When a chip is selected, glow the whole card + slightly scale the chip */
        .banknote-wrapper.selected {
            box-shadow: 0 0 20px rgba(52, 211, 153, 0.9);
            border-color: #34d399;
            background-color: rgba(15, 23, 42, 0.9);
        }

        .banknote-wrapper.selected img {
            transform: scale(1.05);
        }


        /* Dice bowl pulsing glow animation */
        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 15px rgba(250, 204, 21, 0.2); }
            50% { box-shadow: 0 0 30px rgba(250, 204, 21, 0.5); }
        }
        .dice-bowl {
            animation: pulse-glow 3s infinite;
        }
    </style>
</head>

<!-- Full-screen dark background with radial glow effects -->
<body class="bg-[#0f172a] text-white min-h-screen flex items-center justify-center p-6 relative overflow-hidden">
<!-- Decorative blurred glow (top-left) -->
<div class="absolute top-0 left-0 w-96 h-96 bg-purple-600/20 rounded-full blur-3xl -translate-x-1/2 -translate-y-1/2 pointer-events-none"></div>
<!-- Decorative blurred glow (bottom-right) -->
<div class="absolute bottom-0 right-0 w-[500px] h-[500px] bg-blue-600/10 rounded-full blur-3xl translate-x-1/3 translate-y-1/3 pointer-events-none"></div>

<!-- Wrapper for title + 3-column layout -->
<div class="relative z-10 w-full max-w-6xl">

    <!-- GLOBAL GAME TITLE ON TOP -->
    <div class="w-full text-center mb-8">
        <h1 class="text-5xl font-extrabold text-transparent bg-clip-text
                   bg-gradient-to-r from-yellow-300 to-yellow-600 drop-shadow-md">
            Kla Klouk
        </h1>
        <p class="text-slate-400 text-sm mt-2 tracking-wide">
            Place your bets on the mat
        </p>
    </div>

    <!-- Main 3-column layout container (Wager | Mat | Player / Dice) -->
    <div class="flex w-full gap-8 h-[550px]">
        <!-- LEFT COLUMN: Wager / Banknote selection -->
        <div class="w-48 flex flex-col justify-center">
            <div class="bg-slate-800/50 backdrop-blur-sm p-4 rounded-2xl border border-slate-700 shadow-2xl h-full flex flex-col items-center">
                <h3 class="text-gray-400 text-sm font-bold uppercase tracking-widest mb-6">Wager</h3>

                <!-- List of selectable banknotes rendered with Thymeleaf -->
                <div class="flex flex-col space-y-4 w-full flex-1 justify-center items-stretch">
                    <div th:each="value : ${ {'100', '500', '1000', '5000', '10000'} }"
                         class="banknote-wrapper w-full cursor-pointer group relative rounded-xl border border-slate-700 bg-slate-900/70 px-2 py-2 flex items-center justify-center"
                         th:data-value="${value}">
                        <!-- Chip image centered inside the card -->
                        <img th:src="@{'/images/banknote_' + ${value} + '.png'}"
                             class="banknote-img h-16 w-auto object-contain drop-shadow">
                    </div>
                </div>
            </div>
        </div>

        <!-- CENTER COLUMN: Title, balance, and main betting mat -->
        <div class="flex-1 flex flex-col justify-center px-4">

            <!-- Header row: game title (left) and player balance (right) -->
            <div class="w-full max-w-[550px] mx-auto mb-4 flex">
                <!-- Player balance display -->
                <div class="flex flex-col text-left6">
                    <div class="text-[14px] text-slate-400 uppercase tracking-wide">
                        Your Balance
                    </div>

                    <div class="text-3xl font-bold text-white drop-shadow-md leading-none mt-1">
                    <span id="balance"
                          th:text="${#numbers.formatInteger(player.balance, 0, 'COMMA')}">2,000</span>
                        <span class="text-lg text-yellow-500 ml-1">riel</span>
                    </div>

                    <!-- Fixed-height slot for delta -->
                    <div
                            id="balance-change"
                            class="text-sm font-semibold mt-1 h-5 flex items-center opacity-0 transition-opacity duration-300"
                    >
                        &nbsp; <!-- non-breaking space so height is always reserved -->
                    </div>
                </div>
            </div>


            <!-- Betting mat: 3x2 grid of animal / symbol tiles -->
            <div class="game-mat w-full max-w-[550px] mx-auto rounded-xl p-2 grid grid-cols-3 gap-[2px] shadow-2xl border-[6px] border-[#dcd0b0]">

                <!-- Each symbol tile is rendered with Thymeleaf using th:each -->
                <div th:each="symbol : ${ {'TIGER', 'GOURD', 'ROOSTER', 'SHRIMP', 'CRAB', 'FISH'} }"
                     th:data-symbol="${symbol}"
                     class="symbol symbol-container aspect-square relative cursor-pointer border border-dashed border-gray-400/40 rounded-md flex items-center justify-center group bg-opacity-50 hover:bg-white/20">

                    <!-- Floating bet label (chip) for this symbol; shown when bet > 0 -->
                    <div class="bet-label absolute top-2 right-2 bg-gray-900/90 backdrop-blur text-yellow-400 border border-yellow-500/30 rounded-full px-2 py-1 text-[10px] font-bold shadow-lg z-10 flex items-center gap-1 opacity-0 transition-all duration-300 transform scale-90"
                         th:id="'bet-label-' + ${symbol}">
                        <span>ðŸª™</span> <span class="bet-amount">0</span>
                    </div>

                    <!-- Symbol image (TIGER, GOURD, etc.) dynamically resolved by name -->
                    <img th:src="@{'/images/symbol_' + ${#strings.toLowerCase(symbol)} + '.png'}"
                         th:alt="${symbol}"
                         class="w-[70%] h-[70%] object-contain drop-shadow-md group-hover:scale-110 transition-transform duration-300">
                </div>
            </div>
        </div>

        <!-- RIGHT COLUMN: Player card, dice bowl, and control buttons -->
        <div class="w-75 flex flex-col space-y-6 pt-10">

            <!-- Player / Scoreboard card -->
            <section
                    class="bg-slate-950/60 border border-slate-800 rounded-3xl px-4 py-4 flex flex-col gap-3 shadow"
                    aria-label="Player scoreboard"
            >
                <div class="flex items-center gap-3">
                    <!-- Circular avatar with player's initial -->
                    <div class="w-12 h-12 rounded-full bg-gradient-to-br from-indigo-400 to-sky-500 flex items-center justify-center text-sm font-bold">
                        <span th:text="${#strings.substring(player.name, 0, 1).toUpperCase()}">P</span>
                    </div>

                    <!-- Player label + name -->
                    <div class="flex flex-col">
                <span class="text-[17px] tracking-[0.07em] uppercase text-slate-400">
                    Player
                </span>
                        <span class="text-sm font-semibold" th:text="${player.name}">Player</span>
                    </div>
                </div>

                <!-- Progress bar (win rate) -->
                <div class="mt-1">
                    <div class="flex justify-between text-[17px] text-slate-400 mb-1">
                        <span>Win rate</span>
                        <span
                                id="winRate"
                                th:text="${#numbers.formatDecimal(player.winRate,1,1)} + '%'"
                        >
                    0.0%
                </span>
                    </div>
                    <div class="w-full h-1.5 rounded-full bg-slate-800 overflow-hidden">
                        <div
                                id="winRateBar"
                                class="h-full bg-gradient-to-r from-emerald-400 to-sky-400"
                                th:style="'width:' + ${player.winRate} + '%;'"
                        ></div>
                    </div>
                </div>

                <!-- Stats row: wins / losses / highest balance -->
                <div class="mt-2 grid grid-cols-3 gap-2 text-[17px]">
                    <div class="flex flex-col">
                        <span class="text-slate-400">Wins</span>
                        <span
                                id="totalWins"
                                class="font-semibold text-emerald-300"
                                th:text="${player.totalWins}"
                        >
                            0
                        </span>
                    </div>
                    <div class="flex flex-col">
                        <span class="text-slate-400">Losses</span>
                        <span
                                id="totalLosses"
                                class="font-semibold text-rose-300"
                                th:text="${player.totalLosses}"
                        >
                    0
                </span>
                    </div>
                    <div class="flex flex-col">
                        <span class="text-slate-400">High balance</span>
                        <span
                                id="highestBalance"
                                class="font-semibold text-amber-300"
                                th:attr="data-highest=${player.highestBalance}"
                                th:text="${#numbers.formatInteger(player.highestBalance,0,'COMMA')} + ' riel'"
                        >
                    10,000 riel
                </span>
                    </div>
                </div>
            </section>

            <!-- Dice bowl and result area (unchanged) -->
            <div class="flex-1 flex flex-col items-center justify-center relative">
                <div class="dice-bowl w-56 h-56 rounded-full bg-gray-900 border-[6px] border-slate-700 flex items-center justify-center relative shadow-[0_10px_30px_rgba(0,0,0,0.6)]">

                    <div class="absolute inset-0 rounded-full shadow-[inset_0_10px_20px_rgba(0,0,0,0.8)] pointer-events-none z-20"></div>

                    <div id="dice-result" class="flex gap-2 z-10">
                        <img th:each="i : ${#numbers.sequence(1, 3)}"
                             src="/images/dice_placeholder.png"
                             class="w-12 h-12 rounded-lg shadow-lg bg-[#f0f0f0]"
                             th:id="'dice-' + ${i}">
                    </div>
                </div>
                <p class="mt-4 text-slate-500 text-sm font-medium tracking-wider">RESULT AREA</p>
            </div>

            <!-- Buttons (unchanged) -->
            <div class="flex flex-col gap-3">
                <button id="roll-btn"
                        class="w-full py-4 bg-gradient-to-r from-yellow-400 to-orange-500 text-gray-900 font-extrabold text-xl rounded-xl shadow-lg hover:shadow-orange-500/30 hover:translate-y-[-2px] active:translate-y-[1px] transition-all duration-200 uppercase tracking-wider">
                    Roll Dice
                </button>
                <button id="undo-btn"
                        class="w-full py-3 bg-slate-700 text-slate-300 font-bold rounded-xl border border-slate-600 hover:bg-slate-600 hover:text-white transition-all uppercase text-sm tracking-wide">
                    Undo Bet
                </button>
            </div>

        </div>
    </div>
</div>

<!-- Game over / reset modal -->
<div id="reset-modal"
     class="fixed inset-0 z-50 hidden flex items-center justify-center bg-black/60 backdrop-blur-sm">
    <div class="bg-slate-900 border border-slate-700 rounded-2xl shadow-2xl p-6 w-full max-w-sm">
        <h2 class="text-xl font-semibold mb-2 text-white">
            You are out of balance
        </h2>
        <p class="text-sm text-slate-300 mb-5">
            Your balance is <span class="font-semibold">0 riel</span>.
            Do you want to reset the game with a fresh balance, or go back to the login page?
        </p>

        <div class="flex justify-end gap-3">
            <button id="reset-login-btn"
                    class="px-3 py-2 rounded-xl border border-slate-600 text-sm text-slate-200 bg-slate-800 hover:bg-slate-700 transition">
                Back to login
            </button>
            <button id="reset-game-btn"
                    class="px-4 py-2 rounded-xl text-sm font-semibold bg-emerald-500 text-slate-900 hover:bg-emerald-400 transition">
                Reset game
            </button>
        </div>
    </div>
</div>

<!-- Expose server-side player data to JavaScript (Thymeleaf inline JS) -->
<script th:inline="javascript">
    const playerName    = /*[[${player.name}]]*/ 'Player1';
    let currentBalance  = /*[[${player.balance}]]*/ 10000;
</script>

<!-- Main game logic (handles clicks, bets, dice rolling, etc.) -->
<script src="/js/game.js"></script>

<!-- Notes for future devs: how bet labels should be updated -->
<script>
    // You can modify updateUI in game.js to control bet-label visibility.
    // When a symbol has a bet > 0, show its corresponding label; otherwise hide it.

    /*
      Example in game.js:

      function updateUIForSymbol(symbol, amount) {
          const label = document.getElementById('bet-label-' + symbol);
          if (!label) return;

          const amountSpan = label.querySelector('.bet-amount');
          amountSpan.textContent = amount;

          if (amount > 0) {
              label.style.opacity = "1";
              label.style.transform = "scale(1)";
          } else {
              label.style.opacity = "0";
              label.style.transform = "scale(0.9)";
          }
      }
    */
</script>
</body>
</html>
